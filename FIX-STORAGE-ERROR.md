# ๐ผ๏ธ ุญู ูุดููุฉ "new row violates row-level security policy" ุนูุฏ ุฑูุน ุงูุตูุฑ

## โ ุงููุดููุฉ

ุนูุฏ ูุญุงููุฉ ุฅุถุงูุฉ ููุชุฌ ูุน ุตูุฑุฉุ ุชุธูุฑ ุงูุฑุณุงูุฉ:
```
Error Type: Console StorageApiError
Error Message: new row violates row-level security policy
```

## ๐ฏ ุงูุณุจุจ

ุงููุดููุฉ **ููุณุช** ูู ุฌุฏูู ุงูููุชุฌุงุชุ ุงููุดููุฉ ูู **Storage** (ุฑูุน ุงูุตูุฑ)!

Supabase Storage ูุญุชุงุฌ:
1. โ Bucket (ูุฌูุฏ ููุตูุฑ)
2. โ Policies (ุณูุงุณุงุช ููุณูุงุญ ุจุงูุฑูุน)

---

## โ ุงูุญู (5 ุฏูุงุฆู)

### **ุงูุฎุทูุฉ 1๏ธโฃ: ุฅูุดุงุก Storage Bucket**

1. **ุงูุชุญ Supabase Dashboard**: https://supabase.com
2. **ุงุฎุชุฑ ูุดุฑูุนู**
3. **ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ**: ุงุถุบุท ุนูู **Storage**
4. **ุงุถุบุท**: **"New bucket"** ุฃู **"Create bucket"**
5. **ุงููุฃ ุงูุจูุงูุงุช:**
   - **Name**: `product-images` (ุจุงูุถุจุท ุจููุณ ุงููุชุงุจุฉ!)
   - **Public**: โ **Yes** (ููู ุฌุฏุงู! ุงุฎุชุฑ Yes)
   - **File size limit**: ุงุชุฑูู ููุง ูู
6. **ุงุถุบุท**: **"Create bucket"** ุฃู **"Save"**

โ **ุชู ุฅูุดุงุก Bucket!**

---

### **ุงูุฎุทูุฉ 2๏ธโฃ: ุฅุนุฏุงุฏ ุงูุณูุงุณุงุช (Policies)**

1. **ุงูุชุญ SQL Editor**: ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ูู Supabase
2. **ุงูุชุญ ููู**: `setup-storage-policies.sql` ูู ูุฌูุฏ ุงููุดุฑูุน
3. **ุงูุณุฎ ูู ูุญุชูู ุงูููู**
4. **ุงูุตูู ูู SQL Editor**
5. **ุงุถุบุท Run** โถ๏ธ
6. **ุดูู "ุงูุชูุฑูุฑ ุงูุดุงูู"** ูู ุขุฎุฑ ุงููุชุงุฆุฌ

### โ ูุฌุจ ุฃู ุชุฑู:
```
| check_name                       | status                           |
|----------------------------------|----------------------------------|
| 1. Bucket product-images ููุฌูุฏ   | โ ูุนู                           |
| 2. Bucket ุนุงู (Public)            | โ ูุนู                           |
| 3. ุฃูุช ูุณุฌู ุฏุฎูู                  | โ ูุนู - your@email.com          |
| 4. ุฃูุช ูุณุฌู ูุฃุฏูู                 | โ ูุนู                           |
| 5. ุณูุงุณุงุช Storage ุตุญูุญุฉ           | โ ูุนู                           |
| 6. ููููู ุฑูุน ุตูุฑ                  | โ ูุนู - ูู ุดูุก ุฌุงูุฒ!            |
```

---

### **ุงูุฎุทูุฉ 3๏ธโฃ: ุงุฎุชุจุงุฑ ุงูุญู**

1. **ุณุฌู ุฎุฑูุฌ** ูู ุงููููุน
2. **ุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู**
3. **ุงุฏุฎู ููุญุฉ ุงูุฃุฏูู** โ **ุงูููุชุฌุงุช**
4. **ุงุถุบุท "ุฅุถุงูุฉ ููุชุฌ"**
5. **ุงููุฃ ุงูุจูุงูุงุช ูุงุฑูุน ุตูุฑุฉ**
6. **ุงุถุบุท ุญูุธ**

### โ ูุฌุจ ุฃู ูุนูู ุงูุขู ุจุฏูู ุฃุฎุทุงุก! ๐

---

## ๐ ุดุฑุญ ุงูุณูุงุณุงุช

ุจุนุฏ ุชุดุบูู `setup-storage-policies.sql`:

| ุงูุนูููุฉ | ุงููุณููุญ ููู |
|---------|-------------|
| **ูุฑุงุกุฉ ุงูุตูุฑ** (ุนุฑุถ ูู ุงููููุน) | ุงูุฌููุน โ |
| **ุฑูุน ุตูุฑ** | ุงูุฃุฏูู ููุท ๐ |
| **ุชุนุฏูู ุตูุฑ** | ุงูุฃุฏูู ููุท ๐ |
| **ุญุฐู ุตูุฑ** | ุงูุฃุฏูู ููุท ๐ |

---

## โ ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### **ุงููุดููุฉ 1: "Bucket product-images does not exist"**

**ุงูุณุจุจ:** ูู ุชูุดุฆ Bucket

**ุงูุญู:**
1. ุงุฐูุจ ุฅูู **Storage** ูู Supabase
2. ุงุถุบุท **"New bucket"**
3. ุงูุงุณู: `product-images`
4. Public: **Yes**
5. ุงุญูุธ

---

### **ุงููุดููุฉ 2: "ูุง ุฒุงูุช ุงููุดููุฉ ููุฌูุฏุฉ ุจุนุฏ ุชุดุบูู ุงูููู"**

**ุงูุณุจุจ:** ูู ุชุณุฌู ุฎุฑูุฌ ูุณุฌู ุฏุฎูู

**ุงูุญู:**
1. ุณุฌู ุฎุฑูุฌ ูู ุงููููุน
2. ุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู
3. ุฌุฑุจ ุฑูุน ุตูุฑุฉ

---

### **ุงููุดููุฉ 3: "ุงูุชูุฑูุฑ ูุธูุฑ โ ูุง ุนูู ุฃู ููุทุฉ"**

**ุงูุญู ุญุณุจ ุงูููุทุฉ:**

#### โ "Bucket product-images ููุฌูุฏ"
- ุงุฑุฌุน ููุฎุทูุฉ 1 ูุฃูุดุฆ Bucket

#### โ "Bucket ุนุงู (Public)"
- ุงุฐูุจ ุฅูู Storage โ product-images
- ุงุถุบุท ุนูู ุงูุชุฑุณ โ๏ธ (Settings)
- ูุนูู "Public bucket"
- ุงุญูุธ

#### โ "ุฃูุช ูุณุฌู ุฏุฎูู"
- ุณุฌู ุฏุฎูู ูู ุงููููุน
- ุงุญุชูุธ ุจุงูุชุจููุจ ููุชูุญุงู

#### โ "ุฃูุช ูุณุฌู ูุฃุฏูู"
- ููุฐ ูุฐุง ูู SQL Editor:
  ```sql
  INSERT INTO admins (user_id, email, full_name, role)
  SELECT id, email, raw_user_meta_data->>'full_name', 'super_admin'
  FROM auth.users
  WHERE email = 'ุจุฑูุฏู@example.com'
  ON CONFLICT (user_id) DO UPDATE SET is_active = true;
  ```

#### โ "ุณูุงุณุงุช Storage ุตุญูุญุฉ"
- ุดุบูู `setup-storage-policies.sql` ูุฑุฉ ุฃุฎุฑู

---

### **ุงููุดููุฉ 4: "ุฎุทุฃ 403 Forbidden"**

**ุงูุณุจุจ:** Bucket ุบูุฑ ุนุงู (Private)

**ุงูุญู:**
1. ุงุฐูุจ ุฅูู **Storage** โ **product-images**
2. ุงุถุบุท ุนูู **โ๏ธ Settings**
3. ูุนูู **"Public bucket"**
4. **ุงุญูุธ**
5. ุดุบูู `setup-storage-policies.sql` ูุฑุฉ ุฃุฎุฑู

---

## ๐ ุงูุชุญูู ูู ุงูุฅุนุฏุงุฏุงุช

### **ุงุฎุชุจุงุฑ 1: ุชุญูู ูู Bucket**

```sql
SELECT
  name,
  public,
  'ููุฌูุฏ โ' AS status
FROM storage.buckets
WHERE name = 'product-images';
```

**ูุฌุจ ุฃู ูุธูุฑ:**
```
name: product-images
public: true
status: ููุฌูุฏ โ
```

---

### **ุงุฎุชุจุงุฑ 2: ุชุญูู ูู ุงูุณูุงุณุงุช**

```sql
SELECT policyname
FROM pg_policies
WHERE schemaname = 'storage'
AND tablename = 'objects'
ORDER BY policyname;
```

**ูุฌุจ ุฃู ูุธูุฑ 4 ุณูุงุณุงุช:**
1. Admin delete access for product images
2. Admin update access for product images
3. Admin upload access for product images
4. Public read access for product images

---

### **ุงุฎุชุจุงุฑ 3: ุชุญูู ูู ุตูุงุญูุงุชู**

```sql
SELECT
  EXISTS (
    SELECT 1 FROM admins
    WHERE user_id = auth.uid()
    AND is_active = true
  ) AS i_am_admin;
```

**ูุฌุจ ุฃู ูุธูุฑ:** `true`

---

## ๐ก ุญู ุจุฏูู (ุจุฏูู Storage)

ุฅุฐุง ูู ุชูุฌุญ ูู ุงููุญุงููุงุชุ ููููู ุงุณุชุฎุฏุงู ุฑูุงุจุท ุฎุงุฑุฌูุฉ:

### **ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู Imgur**
1. ุงุฑูุน ุงูุตูุฑุฉ ุนูู https://imgur.com
2. ุงูุณุฎ ุฑุงุจุท ุงูุตูุฑุฉ
3. ุงูุตูู ูู ุญูู "ุฑุงุจุท ุงูุตูุฑุฉ" ูู ุงูููุชุฌ

### **ุงูุทุฑููุฉ 2: ุงุณุชุฎุฏุงู Cloudinary**
1. ุงุฑูุน ุงูุตูุฑุฉ ุนูู https://cloudinary.com
2. ุงูุณุฎ ุฑุงุจุท ุงูุตูุฑุฉ
3. ุงูุตูู ูู ุญูู "ุฑุงุจุท ุงูุตูุฑุฉ"

### **ุงูุทุฑููุฉ 3: ุงุณุชุฎุฏุงู ุฃู ุฑุงุจุท**
- ููููู ุงุณุชุฎุฏุงู ุฃู ุฑุงุจุท ุตูุฑุฉ ูู ุงูุฅูุชุฑูุช
- ููุท ุงูุตูู ูู ุญูู image_url

---

## ๐ ุงูุฎุทูุงุช ุงูุตุญูุญุฉ ุจุงูุชุฑุชูุจ

```bash
โ 1. ุฃูุดุฆ Bucket "product-images" ูู Storage
โ 2. ุงุฌุนู Bucket ุนุงู (Public = Yes)
โ 3. ุดุบูู setup-storage-policies.sql ูู SQL Editor
โ 4. ุดูู ุงูุชูุฑูุฑ ุงูุดุงูู - ูุฌุจ ุฃู ูููู ููู โ
โ 5. ุณุฌู ุฎุฑูุฌ ูู ุงููููุน
โ 6. ุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู
โ 7. ุฌุฑุจ ุฅุถุงูุฉ ููุชุฌ ูุน ุตูุฑุฉ
โ 8. ูุฌุจ ุฃู ูุนูู! ๐
```

---

## ๐ธ ุตูุฑ ุชูุถูุญูุฉ (ุงูุฎุทูุงุช ุงููููุฉ)

### ุฅูุดุงุก Bucket:
```
Storage โ New bucket
โโโ Name: product-images
โโโ Public: Yes โ (ููู!)
โโโ Create bucket
```

### ุฌุนู Bucket ุนุงู:
```
Storage โ product-images โ โ๏ธ Settings
โโโ Public bucket: โ On
```

---

## ๐ ุฎูุงุตุฉ

ุงููุดููุฉ ูุงูุช ูู **Storage** ูุด ูู ุงูููุชุฌุงุช!

**ุงูุญู:**
1. ุฃูุดุฆ Bucket ููุตูุฑ
2. ุงุฌุนูู ุนุงู (Public)
3. ุดุบูู ุงูุณูุงุณุงุช
4. ุฌุฑุจ ุฑูุน ุตูุฑุฉ

**ุงูุขู ูู ุดูุก ูุฌุจ ุฃู ูุนูู!** ๐

---

## ๐ ุฅุฐุง ุงุญุชุฌุช ูุณุงุนุฏุฉ

ุฅุฐุง ุฌุฑุจุช ูู ุงูุฎุทูุงุช ููุณู ุงููุดููุฉ ููุฌูุฏุฉ:

1. ุดุบูู `setup-storage-policies.sql`
2. ุงูุณุฎ ูุชุงุฆุฌ "ุงูุชูุฑูุฑ ุงูุดุงูู"
3. ุงูุณุฎ ูุต ุงูุฎุทุฃ ุงููุงูู ูู Console
4. ุดุงุฑููู ูุนุงูุง

ุณุฃุณุงุนุฏู! ๐ช

---

**ุจุงูุชูููู!** ๐
