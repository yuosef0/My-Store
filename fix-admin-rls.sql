-- ============================================
-- ๐ง ุฅุตูุงุญ RLS ูุฌุฏูู admins
-- ============================================
-- ูุฐุง ุงูููู ูุตูุญ ูุดุงูู Row Level Security
-- ุงูุชู ุชููุน ูุฑุงุกุฉ ุฌุฏูู admins
-- ============================================

-- 1๏ธโฃ ุฅุฒุงูุฉ ุฌููุน ุงูุณูุงุณุงุช ุงููุฏููุฉ
-- ============================================
DROP POLICY IF EXISTS "ูููู ููุฌููุน ูุฑุงุกุฉ ุงูุฃุฏูู ุงููุดุทูู" ON admins;
DROP POLICY IF EXISTS "ุงูุฌููุน ูููููู ูุฑุงุกุฉ ูุนูููุงุช ุงูุฃุฏูู" ON admins;
DROP POLICY IF EXISTS "ุงูุฃุฏูู ูููููู ุฑุคูุฉ ุฌููุน ุงูุฃุฏูู" ON admins;
DROP POLICY IF EXISTS "ุงูุฃุฏูู ูููููู ุชุนุฏูู ุฅุนุฏุงุฏุงุช ุงูููุชุฑ" ON admins;
DROP POLICY IF EXISTS "ุงูุฃุฏูู ูููููู ุฅุถุงูุฉ ุฅุนุฏุงุฏุงุช ููุชุฑ" ON admins;
DROP POLICY IF EXISTS "ุงูุฃุฏูู ูููููู ุญุฐู ุฅุนุฏุงุฏุงุช ุงูููุชุฑ" ON admins;

-- 2๏ธโฃ ุฅูุดุงุก ุณูุงุณุฉ ูุฑุงุกุฉ ุจุณูุทุฉ ูููุชูุญุฉ
-- ============================================
-- ุงูุณูุงุญ ูุฃู ุดุฎุต ุจูุฑุงุกุฉ ุฌุฏูู admins
-- ูุฐุง ุขูู ูุฃู ุงูุฌุฏูู ูุญุชูู ููุท ุนูู ูุนูููุงุช ุงูุตูุงุญูุงุช
CREATE POLICY "allow_read_admins" ON admins
    FOR SELECT
    USING (true);

-- 3๏ธโฃ ุงูุณูุงุญ ููุฃุฏูู ููุท ุจุงูุชุนุฏูู (ุงุฎุชูุงุฑู)
-- ============================================
-- CREATE POLICY "allow_admin_update" ON admins
--     FOR UPDATE
--     USING (
--         EXISTS (
--             SELECT 1 FROM admins
--             WHERE user_id = auth.uid()
--             AND is_active = true
--         )
--     );

-- 4๏ธโฃ ุงูุชุญูู ูู ุงูุณูุงุณุงุช ุงููุดุทุฉ
-- ============================================
SELECT
    schemaname,
    tablename,
    policyname,
    permissive,
    roles,
    cmd,
    qual,
    with_check
FROM pg_policies
WHERE tablename = 'admins';

-- 5๏ธโฃ ุชูุนูู ุฌููุน ุญุณุงุจุงุช ุงูุฃุฏูู
-- ============================================
UPDATE admins SET is_active = true;

-- 6๏ธโฃ ุนุฑุถ ุฌููุน ุงูุฃุฏูู
-- ============================================
SELECT
    a.id,
    a.user_id,
    a.role,
    a.is_active,
    a.created_at,
    u.email
FROM admins a
LEFT JOIN auth.users u ON a.user_id = u.id
ORDER BY a.created_at DESC;

-- ============================================
-- โ ุงูุชูู!
-- ============================================
-- ุงูุขู ุฌุฑุจ ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู
-- ูุฌุจ ุฃู ูุธูุฑ ุฒุฑ ููุญุฉ ุงูุชุญูู
-- ============================================
